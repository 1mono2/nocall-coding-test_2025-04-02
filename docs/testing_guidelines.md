# テストに関する指針

## Vitestを使用したコンポーネントテストの手法

### Vitestについて
Vitestは、Viteと統合された次世代のテストフレームワークです。Jestと互換性のあるAPIを提供し、テストの作成と実行を容易にします。

### 前提条件
- Vitestはglobalにインストールされているため、importする必要はありません。

### モック
**推奨:** `vi.spyOn()`を使用することを推奨します。これにより、モックの範囲を限定し、テストの可読性と保守性を向上させます。

#### 使用例

**spyOnの使用例:**

```typescript
import * as module from './module';

test('spyOn example', () => {
  const spy = vi.spyOn(module, 'functionName');
  module.functionName();
  expect(spy).toHaveBeenCalled();
  spy.mockRestore();
});
```

**プロパティーのモック例:**

```typescript
import * as module from './module';

test('spyOn example', () => {
  const spy = vi.spyOn(module, 'property', 'get').mockImplementation(() => {
    return "mocked";
  });
  expect(module.property).toBe("mocked");
});
```

### テスト駆動開発（TDD）
概要: テスト駆動開発（TDD）は、最初にテストを書き、その後で実装コードを作成する開発手法です。これにより、要件の明確化、コードの品質向上、回帰バグの早期発見を実現します。

#### TDDの手順:

TDD（テスト駆動開発）を実践する際の具体的な手順は以下の通りです：

1. **テストの作成（Red）**: まず、実装する機能のテストコードを作成します。このテストは必ず失敗する状態で始めます。

2. **実行と確認**: `vitest run {対象のファイル}` を実行し、予期した通りテストが失敗することを確認します。

3. **最小限の実装（Green）**: テストをパスするための最小限のコードを実装します。

4. **再テスト**: 再度 `vitest run {対象のファイル}` を実行し、テストがパスするか確認します。

5. **リファクタリング（Refactor）**: コードの品質を向上させるためのリファクタリングを行います。リファクタリング後も必ずテストを実行し、機能が正しく動作することを確認します。

6. **繰り返し**: 上記のサイクルを繰り返し、機能を段階的に実装していきます。

#### 注意事項
* ドメインレイヤーのテストはドメイン内に配置
* アプリケーション層やUI層のテストはそれぞれのレイヤーに併設
* ファイル名は `.test.ts` を採用
* `__tests__` フォルダは使わない（co-location方針）
* 各テストケースでは、機能の仕様を明確に理解し、テストの意図が明確になるよう心がけてください。
* テスト作成とエラー修正のサイクルを2回以上繰り返してもエラーが解決できない場合は、問題の具体的な内容と試した解決策を明確にして、ユーザーに支援を求めてください。

#### ベストプラクティス

**テストの独立性**

各テストは他のテストに依存しないように設計します。これにより、テストの実行順序に関係なく、常に一貫した結果が得られます。

**テストの可読性**

テストコードは、実装コードと同様に可読性が重要です。テストの意図が明確になるように、適切な命名とコメントを心がけます。

**テストの範囲**

各テストは、特定の機能や振る舞いを検証することに集中します。過度に広範囲なテストは避け、必要に応じてテストを分割します。また、正常に動作することを検証する正常系テストと、正常に動作しないことを検証する異常系テストを作成します。

**モックの適切な使用**

モックは、外部依存を排除し、テストの対象に集中するために使用します。ただし、過度なモックはテストの信頼性を損なう可能性があるため、必要最低限に留めます。

